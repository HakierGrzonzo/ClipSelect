# ClipSelect

A website that generates gifs based on quotes found in subtitles.

Currently hosted [here](https://grzegorzkoperwas.site).

---------------

Made with flask and materializecss.

## How it works:

### Requirements:

- A MySQL database.
- Machine to serve the website.
- Machine to run `ffmpegScripts/worker.py` to process gifs.
- A link to `ClipSelectDB` folder in `app/static`

The structure of `ClipSelectDB` is as follows:
```
├── gifs
│   ├── <quote_id>.gif
├── <show title>
│   ├── <episode title>
├── <show title>
│   ├── <episode title>
```

This folder will be automaticly generated by `ffmpegScripts/videoConverter.py` which will use
ffmpeg to:
- extract subtitles to .srt file.
- burn subtitles.
- convert video to 10fps 1024x576 jpeg files.
- store them in `ClipSelectDB`.


Then run `ffmpegScripts/Importer.py` to import stuff in `ClipSelectDB` to your MySQL database.


MySQL database needs to have 2 tables:

table subs - containg processed subtitles:

```
+-------------+------+------+-----+---------+----------------+
| Field       | Type | Null | Key | Default | Extra          |
+-------------+------+------+-----+---------+----------------+
| n           | int  | YES  |     | <null>  |                |
| content     | text | YES  |     | <null>  |                |
| series      | text | YES  |     | <null>  |                |
| episode     | text | YES  |     | <null>  |                |
| begin_frame | int  | YES  |     | <null>  |                |
| end_frame   | int  | YES  |     | <null>  |                |
| id          | int  | NO   | PRI | <null>  | auto_increment |
| raw_content | text | YES  |     | <null>  |                |
+-------------+------+------+-----+---------+----------------+
```
 and table jobs containg info about requested gifs:

```
+-----------------+------+------+-----+---------+----------------+
| Field           | Type | Null | Key | Default | Extra          |
+-----------------+------+------+-----+---------+----------------+
| job_id          | int  | NO   | PRI | <null>  | auto_increment |
| gif_id          | int  | YES  |     | <null>  |                |
| result_filepath | text | YES  |     | <null>  |                |
| hits            | int  | YES  |     | <null>  |                |
| status          | int  | YES  |     | <null>  |                |
+-----------------+------+------+-----+---------+----------------+
```

### Operation:

User navigates to a show of their choosing and searches for quotes. When the user
hovers their pointing device of choice over a quote, previous and nex subtitle will
be showed for more context.

When user requests a gif, webserver checks in table `jobs` if it is available. If it
is not, then it adds it with a `status = 0`. `ffmpegScripts/worker.py` than fetches
this request and uses ImageMagick to turn jpegs into a gif and stores it in
`ClipSelectDB/gifs`.

Meanwhile the webserver serves a waiting page that automaticly reloads, thus eventualy
loading the gif.
